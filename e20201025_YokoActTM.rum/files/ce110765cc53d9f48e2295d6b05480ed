using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Charlotte.Commons;
using System.IO;
using Charlotte.GameCommons;

namespace Charlotte.Games
{
	public class World
	{
		public string StartMapName = "t0001"; // 開始マップ名

		// <---- prm

		private string[][] MapNameTableRows; // 添字：[y][x]
		private I2Point CurrPoint;

		public World()
		{
			using (WorkingDir wd = new WorkingDir())
			{
				string file = wd.MakePath();

				File.WriteAllBytes(file, DDResource.Load(@"e20200001_res\World\World.csv"));

				using (CsvFileReader reader = new CsvFileReader(file))
				{
					this.MapNameTableRows = reader.ReadToEnd();
				}
			}
			this.CurrPoint = this.GetPoint(this.StartMapName);
		}

		private I2Point GetPoint(string mapName)
		{
			for (int y = 0; y < this.MapNameTableRows.Length; y++)
				for (int x = 0; x < this.MapNameTableRows[y].Length; x++)
					if (this.MapNameTableRows[y][x] == mapName)
						return new I2Point(x, y);

			throw new DDError("そんなマップありません。" + mapName);
		}

		public string GetCurrMapName()
		{
			return this.MapNameTableRows[this.CurrPoint.Y][this.CurrPoint.X];
		}

		public void Move(int xa, int ya)
		{
			int x = this.CurrPoint.X;
			int y = this.CurrPoint.Y;

			x += xa;
			y += ya;

			if (
				x < 0 ||
				y < 0 ||
				this.MapNameTableRows.Length <= y ||
				this.MapNameTableRows[y].Length <= x
				)
				throw new DDError("移動先にマップはありません。");

			this.CurrPoint.X = x;
			this.CurrPoint.Y = y;
		}

		public void Move(string mapName)
		{
			this.CurrPoint = this.GetPoint(mapName);
		}
	}
}
